#include <math.h>
#include <stdio.h>
#include <string.h>



//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
uint8_t bcd2bin8(uint8_t x)
{

	return (x & 0x0F) + (x >> 4) * 10;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
uint8_t bin2bcd8(uint8_t x)
{

	return ((x / 10) << 4) + x % 10;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
uint16_t bin2bcd16(uint16_t x)
{
	uint_t i;
	char str[6 + 1];
	uint8_t bcd[2 + 1];

	sprintf(str, "%6ld", x);
	for (i = 0;  i < 3;  i++) {
		bcd[2 - i] = ((str[2 * i] & 0x0F) << 4) | (str[2 * i + 1] & 0x0F);
	}
	i = (bcd[1] << 8) | bcd[0];
	return i;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
uint16_t bcd2bin16(uint16_t x)
{
	uint_t i, y = 0, nTemp;
	uint8_t *p = (uint8_t *)&x;

	for (i = 0; i < 2; i++) {
		nTemp = p[i];
		y += ((uint16_t)(nTemp & 0x0F) * (uint16_t)math_pow10[i * 2]);
		y += ((uint16_t)((nTemp >> 4) & 0x0F) * (uint16_t)math_pow10[i * 2 + 1]);
	}
	return y;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
uint32_t bin2bcd32(uint32_t x)
{
	uint_t i;
	char str[10 + 1];
	uint8_t bcd[4 + 1];

	sprintf(str, "%10ld", x);
	for (i = 0;  i < 5;  i++) {
		bcd[4 - i] = ((str[2 * i] & 0x0F) << 4) | (str[2 * i + 1] & 0x0F);
	}
	memcpy(&i, bcd, sizeof(i));
	return i;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
uint32_t bcd2bin32(uint32_t x)
{
	uint_t i, y = 0, nTemp;
	uint8_t *p = (uint8_t *)&x;

	for (i = 0; i < 4; i++) {
		nTemp = p[i];
		y += ((uint32_t)(nTemp & 0x0F) * (uint32_t)math_pow10[i * 2]);
		y += ((uint32_t)((nTemp >> 4) & 0x0F) * (uint32_t)math_pow10[i * 2 + 1]);
	}
	return y;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
uint64_t bin2bcd64(uint64_t x)
{
	uint64_t i;
	char buf[18 + 1];
	uint8_t bcd[8 + 1];
	
	sprintf(buf, "%18lld", x);//////////Unfinished//////////rt_sprintf不支持ll类型
	for (i = 0; i < 9; i++)
		bcd[8 - i] = ((buf[2 * i] & 0x0F) << 4) | (buf[2 * i + 1] & 0x0F);	 
	memcpy(&i, bcd, sizeof(i));
	return i;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
uint64_t bcd2bin64(uint64_t x)
{
	uint64_t y = 0;
	uint_t i, nTemp;
	uint8_t *p = (uint8_t *)&x;

	for (i = 0; i < 8; i++) {
		nTemp = p[i];
		y += ((uint64_t)(nTemp & 0x0F) * (uint64_t)math_pow10[i * 2]);
		y += ((uint64_t)((nTemp >> 4) & 0x0F) * (uint64_t)math_pow10[i * 2 + 1]);
	}
	return y;
}


